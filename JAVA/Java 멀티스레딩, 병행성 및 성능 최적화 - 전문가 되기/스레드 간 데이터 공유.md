### 스레드 간 데어터 공유

#### 스택 메모리 구역

- 스택이란

  - 스택은 메서드가 실행되는 메모리 영역

  - 함수에 인수를 입력할 때마다 스텍에 입력

  - 모든 로컬 변수 또한 스택에 저장

- 스택 특징

  - 스택에 입력된 모든 변수는 특정 스레드에 속하기에

  - 다른 스레드는 변수에 접근 불가능

  - 스레드가 생성될 때 스택은 정적으로 할당되기 때문에

  - 고정된 크기를 갖고 런타임을 변경할수 없다.

  - 너무 많은 메서드 호출을 중첩하면 스택에 할당된 메모리가 고갈

  - StackOverflow 발생한다. -> 재귀 메서드가 특히 그렇다

---

#### 힙 메모리 구역

- 공유 메모리 영역

- 모든스레드가 힙에 있는 모든 데이터를 공유 할수 있다.

- 모든 객체는 힙에 할당된다.

  - String

  - Object

  - Collection

- 객체에 속한 모든 것도 힙에 저장

- 정적 변수 또한 힙에 할당

- 가비지 컬렉터가 관리하고 통제

---

#### 리소스 공유와 임꼐 영역 개요

1. 리소스란?

- 리소스는 여러 쓰레드가 공동으로 사용하는 자원으로, 다음과 같은 종류가 있습니다:

- 데이터

  - 기본 데이터 타입: int, float, boolean 등 숫자나 플래그 값.

  - 은행 계좌 잔고를 나타내는 정수 값.

  - 객체 데이터: String, 사용자 정의 객체 등.

  - 사용자의 이름이나 상태를 저장하는 문자열.

- 데이터 구조

  - 배열, 리스트, 맵 등 여러 데이터를 포함하는 구조.

  - 공유 작업 큐(Queue)나 설정 정보를 저장하는 맵(Map).

- 파일

  - 텍스트 파일, 로그 파일, 데이터베이스 파일 등.

  - 쓰레드가 로그를 기록하기 위해 동일한 로그 파일에 쓰기 작업을 수행.

- 네트워크 리소스

  - 소켓, HTTP 요청, API 연결 등.

  - 여러 쓰레드가 같은 API 서버에 데이터를 요청.

2. 임계 영역(Critical Section)이란?

- 임계 영역은 여러 쓰레드가 동시에 접근하면 문제가 생길 수 있는 코드 블록입니다.

  - 은행 시스템에서 동시에 잔고를 수정하는 작업.

- 임계 영역의 필요성

      - 리소스를 공유할 때, 두 쓰레드가 동시에 읽거나 수정하면 데이터 충돌이 발생할 수 있습니다.

      - 쓰레드 A가 잔고를 읽고 100원을 추가하려는 순간,

  쓰레드 B도 잔고를 읽고 50원을 추가하면, 최종 값이 의도와 다르게 계산될 수 있습니다.

- 임계 영역의 해결 방법

- 동기화를 통해 쓰레드가 임계 영역에 하나씩 접근하도록 제어합니다.

- synchronized 키워드(Java): 특정 메서드나 블록을 임계 영역으로 설정.

- Mutex(뮤텍스): 한 번에 하나의 쓰레드만 리소스에 접근.

- Lock 객체: ReentrantLock 등으로 세밀하게 동기화 제어.

---

![alt text](</JAVA/Java%20멀티스레딩,%20병행성%20및%20성능%20최적화%20-%20전문가%20되기/img/napkin-selection%20(1).png>)
